FROM ubuntu:22.04
ENV DEBIAN_FRONTEND=noninteractive

# 1. 安装基础环境 [cite: 1, 4]
RUN apt-get update && apt-get install -y \
    git \
    net-tools \
    build-essential \
    ca-certificates \
    python3 \
    python3-pip && \
    pip3 install --no-cache-dir pyyaml jinja2 requests psutil pandas matplotlib ccxt && \
    rm -rf /var/lib/apt/lists/* [cite: 1, 2, 4]

RUN ln -s /usr/bin/python3 /usr/bin/python [cite: 2, 4]

WORKDIR /app

# 2. 直接克隆仓库到当前目录 (.)，确保包含 .git 文件夹 
RUN git clone https://github.com/Celia2024-bit/TradeSystem.git . 

# 3. 更新子模块 
RUN git submodule update --init --recursive [cite: 2, 5]

# 4. 安装监控工具依赖 [cite: 3, 5]
RUN pip3 install --no-cache-dir -r tools/performance_monitor/requirements.txt 

# 5. 设置权限 [cite: 3, 5]
RUN mkdir -p output && chmod -R 777 /app 

# 6. 端口与启动命令 [cite: 3, 5]
EXPOSE 8080
# 使用这种写法可以同时兼容 Render 的动态端口和本地 8080 
CMD python3 -m uvicorn server_main:app --host 0.0.0.0 --port ${PORT:-8080}